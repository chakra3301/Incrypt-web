<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@300&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="./assets/favicon.png" />
  <link rel="shortcut icon" type="image/png" href="./assets/favicon.png" />
  <meta property="og:title" content="Incrypt Decoder - Reveal Hidden Files" />
  <meta property="og:description" content="Decode secret files from images using LSB steganography. Client-side processing ensures your data never leaves your device." />
  <meta property="og:image" content="./assets/preview.png" />
  <meta property="og:url" content="" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Incrypt Decoder - Reveal Hidden Files" />
  <meta name="twitter:description" content="Decode secret files from images using LSB steganography. Client-side processing ensures your data never leaves your device." />
  <meta name="twitter:image" content="./assets/preview.png" />
  <link rel="stylesheet" href="./styles/style.css" />
  <style>
    body { background: #111; color: #eee; font-family: 'Orbitron', monospace; font-weight: 300; text-align: center; padding: 2rem; margin: 0; overflow-x: hidden; }
    .header { position: fixed; top: 0; left: 0; width: 100%; display: flex; align-items: center; justify-content: space-between; padding: 10px 20px; background: #11111145; z-index: 1000; box-sizing: border-box; }
    .header-logo { height: 50px; margin-right: auto; filter: brightness(150%); }
    .header-nav { display: flex; flex: 1; justify-content: center; gap: 50px; }
    .nav-button { font-family: 'Orbitron', monospace; font-weight: 300; color: white; text-decoration: none; padding: 10px 15px; border-radius: 5px; transition: background-color 0.3s ease; }
    .nav-button:hover { background-color: rgba(255, 255, 255, 0.2); }
    #matrixCanvas { position: fixed; top: 0; left: 0; z-index: -1; }
    .controls { display: flex; flex-direction: column; align-items: center; gap: 1rem; max-width: 100%; padding: 0 1rem; }
    .progress-bar { width: 100%; height: 8px; background: #222; border-radius: 4px; margin: 1rem 0; overflow: hidden; box-shadow: 0 0 8px #2563eb55; }
    .progress { height: 100%; background: linear-gradient(90deg, #2563eb 0%, #1d4ed8 100%); transition: width 0.3s; border-radius: 4px; }
    .output-box { margin-top: 1rem; padding: 1rem; background: rgba(255,255,255,0.07); border-radius: 5px; display: none; color: #eee; }
    .output-box.show { display: block; }
    #downloadLink { color: #aaf; text-decoration: underline; font-size: 1.1em; display: block; margin-top: 1.5rem; }
  </style>
</head>
<body>
  <header class="header">
    <img src="./assets/clean logo.png" alt="Logo" class="header-logo" />
    <nav class="header-nav">
      <a href="index.html" class="nav-button">Home</a>
      <a href="Encoder.html" class="nav-button">Encoder</a>
      <a href="feed.html" class="nav-button">Feed</a>
      <a href="documentation.html" class="nav-button">Documentation</a>
    </nav>
  </header>
  <canvas id="matrixCanvas"></canvas>
  <div class="controls" style="margin-top: 90px;">
    <h2>Decode Hidden File</h2>
    <input type="file" id="stegoImage" accept="image/png,image/jpeg,image/bmp" style="margin-bottom: 1rem;" />
    <label for="bits">Bits per Channel:</label>
    <select id="bits">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4" selected>4</option>
      <option value="5">5</option>
      <option value="6">6</option>
      <option value="7">7</option>
      <option value="8">8</option>
    </select>
    <button id="decodeBtn" class="action-button">Decode</button>
    <div class="progress-bar" id="progressContainer" style="display:none;"><div class="progress" id="progressBar" style="width:0%"></div></div>
    <div id="outputBox" class="output-box"></div>
    <a id="downloadLink" style="display:none;"></a>
  </div>
  <script>
    // Matrix background animation (copied from Encoder.html)
    const matrixCanvas = document.getElementById('matrixCanvas');
    const matrixCtx = matrixCanvas.getContext('2d');
    matrixCanvas.width = window.innerWidth;
    matrixCanvas.height = window.innerHeight;
    const fontSize = 16;
    const columns = Math.floor(matrixCanvas.width / fontSize);
    const drops = Array(columns).fill(1);
    const characters = 'アカサタナハマヤラワガザダバパABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'.split('');
    let frameCounter = 0;
    const updateRate = 4;
    function drawMatrix() {
      if (frameCounter % updateRate !== 0) {
        requestAnimationFrame(drawMatrix);
        frameCounter++;
        return;
      }
      matrixCtx.fillStyle = "rgba(0, 0, 0, 0.05)";
      matrixCtx.fillRect(0, 0, matrixCanvas.width, matrixCanvas.height);
      matrixCtx.font = `${fontSize}px monospace`;
      for (let i = 0; i < columns; i++) {
        const char = characters[Math.floor(Math.random() * characters.length)];
        const flicker = Math.random() < 0.003;
        if (flicker) {
          matrixCtx.fillStyle = 'rgba(255, 255, 255, 0.4)';
          matrixCtx.shadowBlur = 4;
          matrixCtx.shadowColor = '#ffffff';
        } else {
          matrixCtx.fillStyle = 'rgba(200, 200, 200, 0.15)';
          matrixCtx.shadowBlur = 0;
        }
        matrixCtx.fillText(char, i * fontSize, drops[i] * fontSize);
        if (drops[i] * fontSize > matrixCanvas.height && Math.random() > 0.975) {
          drops[i] = 0;
        }
        drops[i]++;
      }
      frameCounter++;
      requestAnimationFrame(drawMatrix);
    }
    drawMatrix();
    window.addEventListener('resize', () => {
      matrixCanvas.width = window.innerWidth;
      matrixCanvas.height = window.innerHeight;
    });
    // Decoder logic with progress bar
    const decodeBtn = document.getElementById('decodeBtn');
    const stegoImageInput = document.getElementById('stegoImage');
    const bitsInput = document.getElementById('bits');
    const progressContainer = document.getElementById('progressContainer');
    const progressBar = document.getElementById('progressBar');
    const outputBox = document.getElementById('outputBox');
    const downloadLink = document.getElementById('downloadLink');
    decodeBtn.onclick = async function() {
      const stegoFile = stegoImageInput.files[0];
      if (!stegoFile) return alert('Please select an encoded image.');
      const bits = parseInt(bitsInput.value, 10);
      decodeBtn.disabled = true;
      progressContainer.style.display = 'block';
      progressBar.style.width = '0%';
      outputBox.classList.remove('show');
      outputBox.innerHTML = '';
      downloadLink.style.display = 'none';
      // Simulate progress for demo, replace with real logic
      let pct = 0;
      const fakeProgress = setInterval(() => {
        pct += Math.random() * 0.1;
        if (pct > 0.95) pct = 0.95;
        progressBar.style.width = (pct * 100) + '%';
      }, 200);
      // Real decode logic (replace with worker for large files)
      setTimeout(async () => {
        clearInterval(fakeProgress);
        progressBar.style.width = '100%';
        // Read image and decode (simple LSB for demo)
        const img = new Image();
        img.onload = () => {
          const canvas = document.createElement('canvas');
          canvas.width = img.width;
          canvas.height = img.height;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(img, 0, 0);
          const imgData = ctx.getImageData(0, 0, img.width, img.height);
          // Simple LSB decode (replace with robust logic)
          let bitsArr = [];
          for (let i = 0; i < imgData.data.length; i++) {
            for (let b = 0; b < bits; b++) {
              bitsArr.push((imgData.data[i] >> b) & 1);
            }
          }
          // Try to extract a file (demo: just dump bits as bytes)
          let bytes = [];
          for (let i = 0; i < bitsArr.length; i += 8) {
            let byte = 0;
            for (let j = 0; j < 8; j++) {
              if (i + j < bitsArr.length) byte |= bitsArr[i + j] << (7 - j);
            }
            bytes.push(byte);
          }
          const blob = new Blob([new Uint8Array(bytes)]);
          const url = URL.createObjectURL(blob);
          downloadLink.href = url;
          downloadLink.download = 'decoded.bin';
          downloadLink.textContent = 'Download Decoded File';
          downloadLink.style.display = 'block';
          outputBox.innerHTML = '<b>Decoded file ready!</b>';
          outputBox.classList.add('show');
          decodeBtn.disabled = false;
        };
        img.onerror = () => {
          outputBox.innerHTML = '<b>Error loading image.</b>';
          outputBox.classList.add('show');
          decodeBtn.disabled = false;
        };
        img.src = URL.createObjectURL(stegoFile);
      }, 2000);
    };
  </script>
</body>
</html> 